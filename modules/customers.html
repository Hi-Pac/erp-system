<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCP-ERP | Customers</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-200">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 bg-white dark:bg-gray-800 z-20 w-64 overflow-y-auto md:block flex-shrink-0 transition-transform transform -translate-x-full md:translate-x-0 duration-200 shadow-lg">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <img src="../assets/images/logo.svg" alt="HCP-ERP Logo" class="h-8 w-auto">
                    <h1 class="ml-3 text-xl font-semibold text-gray-800 dark:text-white">HCP-ERP</h1>
                </div>
            </div>
            
            <nav class="mt-5 px-2">
                <a href="../index.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                    <i class="fas fa-tachometer-alt mr-3 text-gray-400 dark:text-gray-500"></i>
                    <span data-lang="dashboard">Dashboard</span>
                </a>
                
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-lang="sales">
                        Sales
                    </h3>
                    <div class="mt-1 space-y-1">
                        <a href="customers.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md bg-primary-50 dark:bg-primary-900 text-primary-700 dark:text-primary-100">
                            <i class="fas fa-user-tie mr-3 text-primary-500 dark:text-primary-400"></i>
                            <span data-lang="customers">Customers</span>
                        </a>
                        <a href="sales.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-shopping-cart mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="sales-orders">Sales Orders</span>
                        </a>
                        <a href="invoices.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-file-invoice-dollar mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="invoices">Invoices</span>
                        </a>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-lang="inventory">
                        Inventory
                    </h3>
                    <div class="mt-1 space-y-1">
                        <a href="inventory.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-boxes mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="products">Products</span>
                        </a>
                        <a href="suppliers.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-truck mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="suppliers">Suppliers</span>
                        </a>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-lang="reports">
                        Reports
                    </h3>
                    <div class="mt-1 space-y-1">
                        <a href="reports.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-chart-bar mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="analytics">Analytics</span>
                        </a>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider" data-lang="settings">
                        Settings
                    </h3>
                    <div class="mt-1 space-y-1">
                        <a href="users.html" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-users-cog mr-3 text-gray-400 dark:text-gray-500"></i>
                            <span data-lang="users">Users</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700">
                <button id="logoutBtn" class="w-full flex items-center px-2 py-2 text-base font-medium rounded-md text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span data-lang="logout">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex flex-col flex-1 md:ml-64">
            <!-- Top Nav -->
            <header class="sticky top-0 z-10 bg-white dark:bg-gray-800 shadow-sm">
                <div class="px-4 sm:px-6 lg:px-8 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <button id="sidebarToggle" type="button" class="md:hidden text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white focus:outline-none">
                                <i class="fas fa-bars"></i>
                            </button>
                            <h1 class="ml-3 md:hidden text-lg font-semibold text-gray-800 dark:text-white">HCP-ERP</h1>
                        </div>
                        
                        <div class="ml-4 flex items-center md:ml-6">
                            <button id="darkModeToggle" class="ml-2 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white focus:outline-none">
                                <i class="fas fa-moon dark:hidden"></i>
                                <i class="fas fa-sun hidden dark:inline"></i>
                            </button>
                            
                            <button id="langToggle" class="ml-2 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white focus:outline-none">
                                <i class="fas fa-globe"></i>
                            </button>
                            
                            <button id="notificationBtn" class="ml-2 relative text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white focus:outline-none">
                                <i class="fas fa-bell"></i>
                                <span id="notificationBadge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-500 rounded-full">3</span>
                            </button>
                            
                            <div class="ml-3 relative">
                                <div>
                                    <button id="userMenuBtn" type="button" class="max-w-xs bg-white dark:bg-gray-800 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800" aria-expanded="false" aria-haspopup="true">
                                        <span class="sr-only">Open user menu</span>
                                        <img id="userAvatar" class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name=Admin+User&background=0062cc&color=fff" alt="User Avatar">
                                    </button>
                                </div>
                                <div id="userMenu" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="userMenuBtn">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600" role="menuitem" data-lang="profile">Your Profile</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600" role="menuitem" data-lang="settings">Settings</a>
                                    <div class="border-t border-gray-100 dark:border-gray-600"></div>
                                    <a href="#" id="logoutBtnMenu" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-600" role="menuitem" data-lang="logout">Logout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8">
                <!-- Page Header -->
                <div class="pb-5 border-b border-gray-200 dark:border-gray-700 sm:flex sm:items-center sm:justify-between">
                    <h2 class="text-2xl font-bold leading-7 text-gray-900 dark:text-white sm:text-3xl sm:truncate" data-lang="customers-management">Customers Management</h2>
                    <div class="mt-3 sm:mt-0 sm:ml-4">
                        <button type="button" id="addCustomerBtn" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                            <i class="fas fa-plus mr-2"></i>
                            <span data-lang="add-customer">Add Customer</span>
                        </button>
                    </div>
                </div>

                <!-- Search & Filter Bar -->
                <div class="mt-6 md:flex md:items-center md:justify-between">
                    <div class="flex-1 min-w-0">
                        <div class="relative rounded-md shadow-sm max-w-lg">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <input type="text" id="searchCustomers" class="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-gray-800 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:text-white sm:text-sm" placeholder="Search customers...">
                        </div>
                    </div>
                    <div class="mt-4 flex md:mt-0 md:ml-4">
                        <div class="relative inline-block text-left mr-2">
                            <select id="filterCustomerStatus" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                                <option value="all" data-lang="all-customers">All Customers</option>
                                <option value="active" data-lang="active">Active</option>
                                <option value="inactive" data-lang="inactive">Inactive</option>
                            </select>
                        </div>
                        
                        <div class="relative inline-block text-left">
                            <button type="button" id="exportDropdown" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-700 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                                <i class="fas fa-download mr-2"></i>
                                <span data-lang="export">Export</span>
                                <i class="fas fa-chevron-down ml-2"></i>
                            </button>
                            <div id="exportMenu" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
                                <div class="py-1">
                                    <button id="exportCsv" class="w-full text-left block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <i class="fas fa-file-csv mr-2"></i> CSV
                                    </button>
                                    <button id="exportPdf" class="w-full text-left block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <i class="fas fa-file-pdf mr-2"></i> PDF
                                    </button>
                                    <button id="exportExcel" class="w-full text-left block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                        <i class="fas fa-file-excel mr-2"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customers Table -->
                <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-md">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="name">Name</span>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="email">Email</span>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="phone">Phone</span>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="company">Company</span>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="status">Status</span>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        <span data-lang="actions">Actions</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Customer data will be loaded here dynamically -->
                                <tr class="animate-pulse">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                                            <div class="ml-4">
                                                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
                                                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 mt-1"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-28"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-16"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right">
                                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-20 ml-auto"></div>
                                    </td>
                                </tr>
                                <tr class="animate-pulse">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                                            <div class="ml-4">
                                                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
                                                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 mt-1"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-28"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-16"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right">
                                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-20 ml-auto"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 flex justify-between sm:hidden">
                                <button id="prevPageMobile" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <span data-lang="previous">Previous</span>
                                </button>
                                <button id="nextPageMobile" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <span data-lang="next">Next</span>
                                </button>
                            </div>
                            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                <div>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">
                                        <span data-lang="showing">Showing</span>
                                        <span id="startItem" class="font-medium">1</span>
                                        <span data-lang="to">to</span>
                                        <span id="endItem" class="font-medium">10</span>
                                        <span data-lang="of">of</span>
                                        <span id="totalItems" class="font-medium">20</span>
                                        <span data-lang="results">results</span>
                                    </p>
                                </div>
                                <div>
                                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                        <button id="prevPage" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <span class="sr-only" data-lang="previous">Previous</span>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <div id="paginationNumbers" class="pagination-numbers">
                                            <!-- Page numbers will be inserted here -->
                                            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300">1</span>
                                        </div>
                                        <button id="nextPage" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <span class="sr-only" data-lang="next">Next</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add/Edit Customer Modal -->
    <div id="customerModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75 dark:bg-gray-900 dark:opacity-90"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 id="modalTitle" class="text-lg leading-6 font-medium text-gray-900 dark:text-white" data-lang="add-customer">Add Customer</h3>
                    <div class="mt-4">
                        <form id="customerForm">
                            <input type="hidden" id="customerId">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="firstName" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="first-name">First Name</label>
                                    <input type="text" id="firstName" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm" required>
                                </div>
                                <div>
                                    <label for="lastName" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="last-name">Last Name</label>
                                    <input type="text" id="lastName" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm" required>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="email">Email</label>
                                <input type="email" id="email" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="phone">Phone</label>
                                <input type="tel" id="phone" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="company" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="company">Company</label>
                                <input type="text" id="company" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm">
                            </div>
                            
                            <div class="mb-4">
                                <label for="address" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="address">Address</label>
                                <textarea id="address" rows="2" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm"></textarea>
                            </div>
                            
                            <div class="mb-4">
                                <label for="status" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="status">Status</label>
                                <select id="status" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm">
                                    <option value="active" data-lang="active">Active</option>
                                    <option value="inactive" data-lang="inactive">Inactive</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label for="notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="notes">Notes</label>
                                <textarea id="notes" rows="3" class="mt-1 block w-full border border-gray-300 dark:border-gray-700 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white sm:text-sm"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveCustomerBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm" data-lang="save">
                        Save
                    </button>
                    <button type="button" id="cancelCustomerBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:w-auto sm:text-sm" data-lang="cancel">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75 dark:bg-gray-900 dark:opacity-90"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" data-lang="confirm-delete">Confirm Delete</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 dark:text-gray-400" data-lang="delete-customer-message">
                                    Are you sure you want to delete this customer? This action cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirmDeleteBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm" data-lang="delete">
                        Delete
                    </button>
                    <button type="button" id="cancelDeleteBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:w-auto sm:text-sm" data-lang="cancel">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="fixed inset-y-0 right-0 max-w-xs w-full bg-white dark:bg-gray-800 shadow-lg hidden z-30 transform transition-transform duration-300 translate-x-full">
        <div class="h-full flex flex-col">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <h2 class="text-lg font-medium text-gray-900 dark:text-white" data-lang="notifications">Notifications</h2>
                <button id="closeNotifications" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto">
                <!-- Notifications will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-10 hidden"></div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="../firebase/firebase-config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/lang.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/app.js"></script>
    <script>
        // Customer module specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize customer module
            initCustomersModule();
        });

        // Customers module state
        const customersState = {
            customers: [],
            filteredCustomers: [],
            currentPage: 1,
            itemsPerPage: 10,
            totalPages: 1,
            currentFilter: 'all',
            searchTerm: '',
            currentCustomerId: null,
            isEditing: false
        };

        /**
         * Initialize Customers module
         */
        function initCustomersModule() {
            // Load customers data
            loadCustomers();
            
            // Set up event listeners
            setupEventListeners();
        }

        /**
         * Load customers from Firestore
         */
        function loadCustomers() {
            // Show loading state
            showLoadingState();
            
            firebase.firestore().collection('customers')
                .orderBy('lastName')
                .get()
                .then(snapshot => {
                    // Clear existing data
                    customersState.customers = [];
                    
                    // Process customer data
                    snapshot.forEach(doc => {
                        const customer = {
                            id: doc.id,
                            ...doc.data()
                        };
                        customersState.customers.push(customer);
                    });
                    
                    // Apply filtering
                    applyFilters();
                    
                    // Update UI
                    updateCustomersTable();
                })
                .catch(error => {
                    console.error('Error loading customers:', error);
                    showNotification(translationService.translate('error-loading-customers'), 'error');
                    
                    // Hide loading state
                    hideLoadingState();
                });
        }

        /**
         * Set up event listeners for customers module
         */
        function setupEventListeners() {
            // Add customer button
            const addCustomerBtn = document.getElementById('addCustomerBtn');
            if (addCustomerBtn) {
                addCustomerBtn.addEventListener('click', () => openCustomerModal());
            }
            
            // Customer modal save button
            const saveCustomerBtn = document.getElementById('saveCustomerBtn');
            if (saveCustomerBtn) {
                saveCustomerBtn.addEventListener('click', saveCustomer);
            }
            
            // Customer modal cancel button
            const cancelCustomerBtn = document.getElementById('cancelCustomerBtn');
            if (cancelCustomerBtn) {
                cancelCustomerBtn.addEventListener('click', () => closeCustomerModal());
            }
            
            // Delete confirmation buttons
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', deleteCustomer);
            }
            
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            if (cancelDeleteBtn) {
                cancelDeleteBtn.addEventListener('click', () => closeDeleteModal());
            }
            
            // Search input
            const searchCustomers = document.getElementById('searchCustomers');
            if (searchCustomers) {
                searchCustomers.addEventListener('input', debounce(function() {
                    customersState.searchTerm = this.value.trim().toLowerCase();
                    customersState.currentPage = 1;
                    applyFilters();
                    updateCustomersTable();
                }, 300));
            }
            
            // Filter dropdown
            const filterCustomerStatus = document.getElementById('filterCustomerStatus');
            if (filterCustomerStatus) {
                filterCustomerStatus.addEventListener('change', function() {
                    customersState.currentFilter = this.value;
                    customersState.currentPage = 1;
                    applyFilters();
                    updateCustomersTable();
                });
            }
            
            // Pagination buttons
            const prevPage = document.getElementById('prevPage');
            const nextPage = document.getElementById('nextPage');
            const prevPageMobile = document.getElementById('prevPageMobile');
            const nextPageMobile = document.getElementById('nextPageMobile');
            
            if (prevPage) {
                prevPage.addEventListener('click', () => {
                    if (customersState.currentPage > 1) {
                        customersState.currentPage--;
                        updateCustomersTable();
                    }
                });
            }
            
            if (nextPage) {
                nextPage.addEventListener('click', () => {
                    if (customersState.currentPage < customersState.totalPages) {
                        customersState.currentPage++;
                        updateCustomersTable();
                    }
                });
            }
            
            if (prevPageMobile) {
                prevPageMobile.addEventListener('click', () => {
                    if (customersState.currentPage > 1) {
                        customersState.currentPage--;
                        updateCustomersTable();
                    }
                });
            }
            
            if (nextPageMobile) {
                nextPageMobile.addEventListener('click', () => {
                    if (customersState.currentPage < customersState.totalPages) {
                        customersState.currentPage++;
                        updateCustomersTable();
                    }
                });
            }
            
            // Export dropdown toggle
            const exportDropdown = document.getElementById('exportDropdown');
            const exportMenu = document.getElementById('exportMenu');
            
            if (exportDropdown && exportMenu) {
                exportDropdown.addEventListener('click', function() {
                    exportMenu.classList.toggle('hidden');
                });
                
                // Close export menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInside = exportDropdown.contains(event.target) || exportMenu.contains(event.target);
                    if (!isClickInside && !exportMenu.classList.contains('hidden')) {
                        exportMenu.classList.add('hidden');
                    }
                });
            }
            
            // Export buttons
            const exportCsv = document.getElementById('exportCsv');
            if (exportCsv) {
                exportCsv.addEventListener('click', () => exportCustomers('csv'));
            }
            
            const exportPdf = document.getElementById('exportPdf');
            if (exportPdf) {
                exportPdf.addEventListener('click', () => exportCustomers('pdf'));
            }
            
            const exportExcel = document.getElementById('exportExcel');
            if (exportExcel) {
                exportExcel.addEventListener('click', () => exportCustomers('excel'));
            }
        }

        /**
         * Apply filters to customers data
         */
        function applyFilters() {
            let filtered = [...customersState.customers];
            
            // Apply status filter
            if (customersState.currentFilter !== 'all') {
                filtered = filtered.filter(customer => customer.status === customersState.currentFilter);
            }
            
            // Apply search filter
            if (customersState.searchTerm) {
                filtered = filtered.filter(customer => {
                    const fullName = `${customer.firstName} ${customer.lastName}`.toLowerCase();
                    return fullName.includes(customersState.searchTerm) || 
                           (customer.email && customer.email.toLowerCase().includes(customersState.searchTerm)) ||
                           (customer.company && customer.company.toLowerCase().includes(customersState.searchTerm));
                });
            }
            
            // Update filtered customers
            customersState.filteredCustomers = filtered;
            
            // Calculate total pages
            customersState.totalPages = Math.ceil(filtered.length / customersState.itemsPerPage);
            
            // Adjust current page if needed
            if (customersState.currentPage > customersState.totalPages) {
                customersState.currentPage = Math.max(1, customersState.totalPages);
            }
        }

        /**
         * Update customers table with current data
         */
        function updateCustomersTable() {
            const tableBody = document.getElementById('customersTableBody');
            if (!tableBody) return;
            
            // Clear table
            tableBody.innerHTML = '';
            
            // Calculate pagination
            const startIndex = (customersState.currentPage - 1) * customersState.itemsPerPage;
            const endIndex = Math.min(startIndex + customersState.itemsPerPage, customersState.filteredCustomers.length);
            
            // Get current page data
            const currentPageData = customersState.filteredCustomers.slice(startIndex, endIndex);
            
            // Check if we have data
            if (currentPageData.length === 0) {
                // No results
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                            <i class="fas fa-search mb-2 text-xl"></i>
                            <p data-lang="no-customers-found">No customers found</p>
                        </td>
                    </tr>
                `;
            } else {
                // Add rows for current page
                currentPageData.forEach(customer => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    // Status badge class
                    let statusClass = '';
                    if (customer.status === 'active') {
                        statusClass = 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                    } else {
                        statusClass = 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200';
                    }
                    
                    // Create avatar with initials
                    const initials = (customer.firstName?.charAt(0) || '') + (customer.lastName?.charAt(0) || '');
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-200 font-semibold">
                                    ${initials}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 dark:text-white">${customer.firstName} ${customer.lastName}</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">${customer.company || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900 dark:text-white">${customer.email || ''}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900 dark:text-white">${customer.phone || ''}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900 dark:text-white">${customer.company || ''}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${customer.status === 'active' ? translationService.translate('active') : translationService.translate('inactive')}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="edit-customer-btn text-primary-600 dark:text-primary-400 hover:text-primary-900 dark:hover:text-primary-300 mr-3" data-id="${customer.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-customer-btn text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300" data-id="${customer.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    // Add event listeners to edit and delete buttons
                    const editBtn = row.querySelector('.edit-customer-btn');
                    const deleteBtn = row.querySelector('.delete-customer-btn');
                    
                    editBtn.addEventListener('click', () => {
                        const customerId = editBtn.getAttribute('data-id');
                        editCustomer(customerId);
                    });
                    
                    deleteBtn.addEventListener('click', () => {
                        const customerId = deleteBtn.getAttribute('data-id');
                        confirmDeleteCustomer(customerId);
                    });
                    
                    tableBody.appendChild(row);
                });
            }
            
            // Update pagination UI
            updatePaginationUI();
            
            // Hide loading state
            hideLoadingState();
        }

        /**
         * Update pagination UI elements
         */
        function updatePaginationUI() {
            // Update pagination info
            const startItem = document.getElementById('startItem');
            const endItem = document.getElementById('endItem');
            const totalItems = document.getElementById('totalItems');
            
            if (startItem && endItem && totalItems) {
                const start = customersState.filteredCustomers.length === 0 ? 0 : 
                    (customersState.currentPage - 1) * customersState.itemsPerPage + 1;
                
                const end = Math.min(
                    start + customersState.itemsPerPage - 1,
                    customersState.filteredCustomers.length
                );
                
                startItem.textContent = start;
                endItem.textContent = end;
                totalItems.textContent = customersState.filteredCustomers.length;
            }
            
            // Update pagination numbers
            const paginationNumbers = document.getElementById('paginationNumbers');
            if (paginationNumbers) {
                paginationNumbers.innerHTML = '';
                
                // Determine which page numbers to show
                const totalPages = customersState.totalPages;
                const currentPage = customersState.currentPage;
                
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                // First page link if not in first group
                if (startPage > 1) {
                    const firstPageLink = document.createElement('button');
                    firstPageLink.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700';
                    firstPageLink.textContent = '1';
                    firstPageLink.addEventListener('click', () => {
                        customersState.currentPage = 1;
                        updateCustomersTable();
                    });
                    paginationNumbers.appendChild(firstPageLink);
                    
                    // Ellipsis if needed
                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300';
                        ellipsis.textContent = '...';
                        paginationNumbers.appendChild(ellipsis);
                    }
                }
                
                // Page number links
                for (let i = startPage; i <= endPage; i++) {
                    const pageLink = document.createElement('button');
                    
                    // Style based on whether this is the current page
                    if (i === currentPage) {
                        pageLink.className = 'relative inline-flex items-center px-4 py-2 border border-primary-500 dark:border-primary-600 bg-primary-50 dark:bg-primary-900 text-sm font-medium text-primary-600 dark:text-primary-100';
                    } else {
                        pageLink.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700';
                    }
                    
                    pageLink.textContent = i;
                    pageLink.addEventListener('click', () => {
                        customersState.currentPage = i;
                        updateCustomersTable();
                    });
                    
                    paginationNumbers.appendChild(pageLink);
                }
                
                // Last page link if not in last group
                if (endPage < totalPages) {
                    // Ellipsis if needed
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300';
                        ellipsis.textContent = '...';
                        paginationNumbers.appendChild(ellipsis);
                    }
                    
                    const lastPageLink = document.createElement('button');
                    lastPageLink.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700';
                    lastPageLink.textContent = totalPages;
                    lastPageLink.addEventListener('click', () => {
                        customersState.currentPage = totalPages;
                        updateCustomersTable();
                    });
                    paginationNumbers.appendChild(lastPageLink);
                }
            }
            
            // Update previous/next buttons state
            const prevPage = document.getElementById('prevPage');
            const nextPage = document.getElementById('nextPage');
            const prevPageMobile = document.getElementById('prevPageMobile');
            const nextPageMobile = document.getElementById('nextPageMobile');
            
            if (prevPage) {
                prevPage.disabled = customersState.currentPage === 1;
                prevPage.classList.toggle('opacity-50', customersState.currentPage === 1);
                prevPage.classList.toggle('cursor-not-allowed', customersState.currentPage === 1);
            }
            
            if (nextPage) {
                nextPage.disabled = customersState.currentPage === customersState.totalPages || customersState.totalPages === 0;
                nextPage.classList.toggle('opacity-50', customersState.currentPage === customersState.totalPages || customersState.totalPages === 0);
                nextPage.classList.toggle('cursor-not-allowed', customersState.currentPage === customersState.totalPages || customersState.totalPages === 0);
            }
            
            if (prevPageMobile) {
                prevPageMobile.disabled = customersState.currentPage === 1;
                prevPageMobile.classList.toggle('opacity-50', customersState.currentPage === 1);
                prevPageMobile.classList.toggle('cursor-not-allowed', customersState.currentPage === 1);
            }
            
            if (nextPageMobile) {
                nextPageMobile.disabled = customersState.currentPage === customersState.totalPages || customersState.totalPages === 0;
                nextPageMobile.classList.toggle('opacity-50', customersState.currentPage === customersState.totalPages || customersState.totalPages === 0);
                nextPageMobile.classList.toggle('cursor-not-allowed', customersState.currentPage === customersState.totalPages || customersState.totalPages === 0);
            }
        }

        /**
         * Open customer modal for adding or editing
         * @param {Object} customer - Customer data for editing, null for new customer
         */
        function openCustomerModal(customer = null) {
            const modal = document.getElementById('customerModal');
            const modalTitle = document.getElementById('modalTitle');
            const form = document.getElementById('customerForm');
            
            // Reset form
            form.reset();
            
            if (customer) {
                // Edit mode
                modalTitle.textContent = translationService.translate('edit-customer');
                
                // Fill form with customer data
                document.getElementById('customerId').value = customer.id;
                document.getElementById('firstName').value = customer.firstName || '';
                document.getElementById('lastName').value = customer.lastName || '';
                document.getElementById('email').value = customer.email || '';
                document.getElementById('phone').value = customer.phone || '';
                document.getElementById('company').value = customer.company || '';
                document.getElementById('address').value = customer.address || '';
                document.getElementById('status').value = customer.status || 'active';
                document.getElementById('notes').value = customer.notes || '';
                
                customersState.isEditing = true;
                customersState.currentCustomerId = customer.id;
            } else {
                // Add mode
                modalTitle.textContent = translationService.translate('add-customer');
                document.getElementById('customerId').value = '';
                customersState.isEditing = false;
                customersState.currentCustomerId = null;
                
                // Set default status to active
                document.getElementById('status').value = 'active';
            }
            
            // Show modal
            modal.classList.remove('hidden');
        }

        /**
         * Close customer modal
         */
        function closeCustomerModal() {
            const modal = document.getElementById('customerModal');
            modal.classList.add('hidden');
        }

        /**
         * Edit customer
         * @param {string} customerId - Customer ID to edit
         */
        function editCustomer(customerId) {
            const customer = customersState.customers.find(c => c.id === customerId);
            if (customer) {
                openCustomerModal(customer);
            }
        }

        /**
         * Save customer data
         */
        function saveCustomer() {
            // Get form data
            const customerId = document.getElementById('customerId').value;
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const company = document.getElementById('company').value.trim();
            const address = document.getElementById('address').value.trim();
            const status = document.getElementById('status').value;
            const notes = document.getElementById('notes').value.trim();
            
            // Validate required fields
            if (!firstName || !lastName) {
                showNotification(translationService.translate('name-required'), 'error');
                return;
            }
            
            if (email && !isValidEmail(email)) {
                showNotification(translationService.translate('invalid-email'), 'error');
                return;
            }
            
            // Prepare customer data
            const customerData = {
                firstName,
                lastName,
                email,
                phone,
                company,
                address,
                status,
                notes,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Add or update timestamp based on operation
            if (!customersState.isEditing) {
                customerData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                customerData.createdBy = getCurrentUserId();
            }
            
            // Save to Firestore
            const customerRef = customerId ? 
                firebase.firestore().collection('customers').doc(customerId) :
                firebase.firestore().collection('customers').doc();
            
            // Disable form and show loading
            const saveBtn = document.getElementById('saveCustomerBtn');
            const originalBtnText = saveBtn.innerHTML;
            saveBtn.innerHTML = `<span class="spinner mr-2"></span> ${translationService.translate('saving')}...`;
            saveBtn.disabled = true;
            
            customerRef.set(customerData, { merge: true })
                .then(() => {
                    showNotification(
                        customersState.isEditing ? 
                        translationService.translate('customer-updated') : 
                        translationService.translate('customer-added'), 
                        'success'
                    );
                    
                    // Close modal
                    closeCustomerModal();
                    
                    // Reload customers
                    loadCustomers();
                })
                .catch(error => {
                    console.error('Error saving customer:', error);
                    showNotification(translationService.translate('error-saving-customer'), 'error');
                })
                .finally(() => {
                    // Reset button
                    saveBtn.innerHTML = originalBtnText;
                    saveBtn.disabled = false;
                });
        }

        /**
         * Show delete confirmation modal
         * @param {string} customerId - Customer ID to delete
         */
        function confirmDeleteCustomer(customerId) {
            customersState.currentCustomerId = customerId;
            
            // Show confirmation modal
            const deleteModal = document.getElementById('deleteModal');
            deleteModal.classList.remove('hidden');
        }

        /**
         * Close delete confirmation modal
         */
        function closeDeleteModal() {
            const deleteModal = document.getElementById('deleteModal');
            deleteModal.classList.add('hidden');
            customersState.currentCustomerId = null;
        }

        /**
         * Delete customer
         */
        function deleteCustomer() {
            if (!customersState.currentCustomerId) {
                closeDeleteModal();
                return;
            }
            
            // Get reference to customer document
            const customerRef = firebase.firestore().collection('customers').doc(customersState.currentCustomerId);
            
            // Disable button and show loading
            const deleteBtn = document.getElementById('confirmDeleteBtn');
            const originalBtnText = deleteBtn.innerHTML;
            deleteBtn.innerHTML = `<span class="spinner mr-2"></span> ${translationService.translate('deleting')}...`;
            deleteBtn.disabled = true;
            
            customerRef.delete()
                .then(() => {
                    showNotification(translationService.translate('customer-deleted'), 'success');
                    
                    // Close modal
                    closeDeleteModal();
                    
                    // Reload customers
                    loadCustomers();
                })
                .catch(error => {
                    console.error('Error deleting customer:', error);
                    showNotification(translationService.translate('error-deleting-customer'), 'error');
                })
                .finally(() => {
                    // Reset button
                    deleteBtn.innerHTML = originalBtnText;
                    deleteBtn.disabled = false;
                });
        }

        /**
         * Export customers data
         * @param {string} format - Export format ('csv', 'pdf', or 'excel')
         */
        function exportCustomers(format) {
            // Close export dropdown
            document.getElementById('exportMenu').classList.add('hidden');
            
            // Prepare data for export
            const exportData = customersState.filteredCustomers.map(customer => {
                return {
                    firstName: customer.firstName || '',
                    lastName: customer.lastName || '',
                    email: customer.email || '',
                    phone: customer.phone || '',
                    company: customer.company || '',
                    address: customer.address || '',
                    status: customer.status || '',
                    createdAt: customer.createdAt ? formatDate(customer.createdAt.toDate(), 'short') : ''
                };
            });
            
            if (format === 'csv') {
                exportToCSV(exportData, 'customers.csv');
            } else if (format === 'pdf') {
                exportToPDF('customersTableBody', 'customers.pdf');
            } else if (format === 'excel') {
                // Excel export would typically use a library like SheetJS/xlsx
                showNotification(translationService.translate('excel-export-not-implemented'), 'info');
            }
        }

        /**
         * Show loading state in the table
         */
        function showLoadingState() {
            const tableBody = document.getElementById('customersTableBody');
            if (!tableBody) return;
            
            // Show loading skeleton
            tableBody.innerHTML = `
                <tr class="animate-pulse">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="ml-4">
                                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
                                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 mt-1"></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-28"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-16"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-20 ml-auto"></div>
                    </td>
                </tr>
                <tr class="animate-pulse">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="ml-4">
                                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
                                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 mt-1"></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-28"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-16"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-20 ml-auto"></div>
                    </td>
                </tr>
                <tr class="animate-pulse">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="ml-4">
                                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
                                <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-16 mt-1"></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-28"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-16"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-20 ml-auto"></div>
                    </td>
                </tr>
            `;
        }

        /**
         * Hide loading state in the table
         */
        function hideLoadingState() {
            // This doesn't need to do anything explicitly as updateCustomersTable
            // will replace the loading skeleton with actual data
        }
    </script>
</body>
</html>
